<div id="statistics" class="static-page max-width">
    <h1>Configurar novas estatisticas</h1>

    <p>
	Esta página fornece informações sobre como configurar novas estatísticas com base nas informações disponíveis no repositório. É importante saber que, para entender esta informação, é 
	preciso ser-se um utilizador avançado com conhecimento de HTML, CSS e Javascript.
	</p>
	
    <p>
    As estatísticas trabalham enviando pedidos ao RODA por meio da sua API (inspecionar a documentação da API para obter mais informações), coletando os resultados e apresentando-os como 
    gráficos. Todo o processo é feito no lado do cliente por Javascript.
    </p>
    
    <p>
    As secções a seguir fornecem trechos de código que podem ser usados ​​para exibir estatísticas sobre o estado do repositório. É só preciso incluir os snippets de código numa nova página 
    HTML e o mecanismo de Javascript incluído irá lidar com toda a comunicação, carga de trabalho e apresentação. Novos gráficos e estatísticas podem ser criados alterando os parâmetros 
    do pedido "data" incluídos nos snippets (e.g. data-source-filters).
    </p>

    <h2>Índice AIP</h2>
    <h3>No. total de registos descritivos:
        <span class="statistic"
              data-source="index"
              data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
              data-view="text"
              data-view-field="totalCount"></span>
    </h3>
    <pre>
        <code class="html">
&lt;span class="statistic"
  data-source="index"
  data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
  data-view="text"
  data-view-field="totalCount">&lt;/span>
        </code>
    </pre>

    <h3>No. total de fundos:
        <span class="statistic"
              data-source="index"
              data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
              data-source-filters="level=fonds"
              data-view="text"
              data-view-field="totalCount"></span>
    </h3>
    <pre>
        <code class="html">
&lt;span class="statistic"
  data-source="index"
  data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
  data-source-filters="level=fonds"
  data-view="text"
  data-view-field="totalCount">&lt;/span>
        </code>
    </pre>

    <h3>Distribuição dos níveis descritivos</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="index"
                data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
                data-source-facets="level"
                data-view="chart"
                data-view-field="facetResults"
                data-view-type="pie"></canvas>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="index"
        data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
        data-source-facets="level"
        data-view="chart"
        data-view-field="facetResults"
        data-view-type="pie">&lt;/canvas>
            </code>
        </pre>
    </div>

    <h2>Índice de representações</h2>
    <h3>No. total de representações:
        <span class="statistic"
              data-source="index"
              data-source-class="org.roda.core.data.v2.ip.IndexedRepresentation"
              data-view="text"
              data-view-field="totalCount"></span>
    </h3>
    <pre>
        <code class="html">
&lt;span class="statistic"
  data-source="index"
  data-source-class="org.roda.core.data.v2.ip.IndexedRepresentation"
  data-view="text"
  data-view-field="totalCount">&lt;/span>
        </code>
    </pre>

    <h3>Distribuição dos tipos de representações</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="index"
                data-source-class="org.roda.core.data.v2.ip.IndexedRepresentation"
                data-source-facets="type"
                data-view="chart"
                data-view-field="facetResults"
                data-view-type="bar"></canvas>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="index"
        data-source-class="org.roda.core.data.v2.ip.IndexedRepresentation"
        data-source-facets="type"
        data-view="chart"
        data-view-field="facetResults"
        data-view-type="bar">&lt;/canvas>
            </code>
        </pre>
    </div>

    <h2>Índice de ficheiros</h2>
    <h3>No. total de ficheiros:
        <span class="statistic"
              data-source="index"
              data-source-class="org.roda.core.data.v2.ip.IndexedFile"
              data-view="text"
              data-view-field="totalCount"></span>
    </h3>
    <pre>
        <code class="html">
&lt;span class="statistic"
  data-source="index"
  data-source-class="org.roda.core.data.v2.ip.IndexedFile"
  data-view="text"
  data-view-field="totalCount">&lt;/span>
        </code>
    </pre>

    <h3>Distribuição de mimetypes</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="index"
                data-source-class="org.roda.core.data.v2.ip.IndexedFile"
                data-source-facets="formatMimetype"
                data-view="chart"
                data-view-field="facetResults"
                data-view-type="pie"></canvas>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="index"
        data-source-class="org.roda.core.data.v2.ip.IndexedFile"
        data-source-facets="formatMimetype"
        data-view="chart"
        data-view-field="facetResults"
        data-view-type="pie">&lt;/canvas>
            </code>
        </pre>
    </div>

    <h3>Distribuição de PRONOM IDs</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="index"
                data-source-class="org.roda.core.data.v2.ip.IndexedFile"
                data-source-facets="formatPronom"
                data-view="chart"
                data-view-field="facetResults"
                data-view-type="doughnut"></canvas>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="index"
        data-source-class="org.roda.core.data.v2.ip.IndexedFile"
        data-source-facets="formatPronom"
        data-view="chart"
        data-view-field="facetResults"
        data-view-type="doughnut">&lt;/canvas>
            </code>
        </pre>
    </div>

    <h2>Índice de processos</h2>
    <h3>No. total de processos de ingestão:
        <span class="statistic"
              data-source="index"
              data-source-class="org.roda.core.data.v2.jobs.Job"
              data-source-filters="pluginType=INGEST, state=COMPLETED"
              data-source-facets="pluginType"
              data-view="text"
              data-view-field="totalCount"></span>
    </h3>
    <pre>
        <code class="html">
&lt;span class="statistic"
  data-source="index"
  data-source-class="org.roda.core.data.v2.jobs.Job"
  data-source-filters="pluginType=INGEST, state=COMPLETED"
  data-source-facets="pluginType"
  data-view="text"
  data-view-field="totalCount">&lt;/span>
        </code>
    </pre>

    <h2>Índice de registros</h2>
    <h3>No. total de logins:
        <span class="statistic"
              data-source="index"
              data-source-class="org.roda.core.data.v2.log.LogEntry"
              data-source-filters="actionComponent=org.roda.wui.api.controllers.UserLogin, actionMethod=login, state=SUCCESS"
              data-view="text"
              data-view-field="totalCount"></span>
    </h3>
    <pre>
        <code class="html">
&lt;span class="statistic"
  data-source="index"
  data-source-class="org.roda.core.data.v2.log.LogEntry"
  data-source-filters="actionComponent=org.roda.wui.api.controllers.UserLogin, actionMethod=login, state=SUCCESS"
  data-view="text"
  data-view-field="totalCount">&lt;/span>
        </code>
    </pre>

    <h3>No. total de logins falhados:
        <span class="statistic"
              data-source="index"
              data-source-class="org.roda.core.data.v2.log.LogEntry"
              data-source-filters="actionComponent=org.roda.wui.api.controllers.UserLogin, actionMethod=login, state=FAILURE"
              data-view="text"
              data-view-field="totalCount"></span>
    </h3>
    <pre>
        <code class="html">
&lt;span class="statistic"
  data-source="index"
  data-source-class="org.roda.core.data.v2.log.LogEntry"
  data-source-filters="actionComponent=org.roda.wui.api.controllers.UserLogin, actionMethod=login, state=FAILURE"
  data-view="text"
  data-view-field="totalCount">&lt;/span>
        </code>
    </pre>

    <h3>Login com sucesso vs falhados</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="index"
                data-source-class="org.roda.core.data.v2.log.LogEntry"
                data-source-filters="actionComponent=org.roda.wui.api.controllers.UserLogin, actionMethod=login"
                data-source-facets="state"
                data-view="chart"
                data-view-field="facetResults"
                data-view-type="pie"></canvas>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="index"
        data-source-class="org.roda.core.data.v2.log.LogEntry"
        data-source-filters="actionComponent=org.roda.wui.api.controllers.UserLogin, actionMethod=login"
        data-source-facets="state"
        data-view="chart"
        data-view-field="facetResults"
        data-view-type="pie">&lt;/canvas>
            </code>
        </pre>
    </div>

    <h1>Outros gráficos</h1>

    <h2>Gráficos de linhas</h2>
    <h3>Distribuição de nivel descritivos</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="index"
                data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
                data-source-facets="level"
                data-view="chart"
                data-view-field="facetResults"
                data-view-type="line"></canvas>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="index"
        data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
        data-source-facets="level"
        data-view="chart"
        data-view-field="facetResults"
        data-view-type="line">&lt;/canvas>
            </code>
        </pre>
    </div>

    <h2>Gráficos de radar</h2>
    <h3>Distribuição de formatos PRONOM</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="index"
                data-source-class="org.roda.core.data.v2.ip.IndexedFile"
                data-source-facets="formatPronom"
                data-view="chart"
                data-view-field="facetResults"
                data-view-type="radar"></canvas>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="index"
        data-source-class="org.roda.core.data.v2.ip.IndexedFile"
        data-source-facets="formatPronom"
        data-view="chart"
        data-view-field="facetResults"
        data-view-type="radar">&lt;/canvas>
            </code>
        </pre>
    </div>

    <h2>Gráficos polares</h2>
    <h3>Distribuição de formatos PRONOM</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="index"
                data-source-class="org.roda.core.data.v2.ip.IndexedFile"
                data-source-facets="formatPronom"
                data-view="chart"
                data-view-field="facetResults"
                data-view-type="polarArea"></canvas>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="index"
        data-source-class="org.roda.core.data.v2.ip.IndexedFile"
        data-source-facets="formatPronom"
        data-view="chart"
        data-view-field="facetResults"
        data-view-type="polarArea">&lt;/canvas>
            </code>
        </pre>
    </div>

    <h2>Função personalizada para manipular dados de facetas</h2>
    <h3>Distribuição de formatos PRONOM</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="index"
                data-source-class="org.roda.core.data.v2.ip.IndexedFile"
                data-source-facets="formatPronom"
                data-view="chart"
                data-view-field="facetResults"
                data-view-type="function"
                data-view-type-function="facetCustomDataHandlerChartOptions"></canvas>
        <script type="text/javascript">
            function facetCustomDataHandlerChartOptions(data, element){
                var options = {};
                var facet = data.facetResults.length > 0 ? data.facetResults[0] : null;
                if (facet) {
                    options = {
                        type: "pie",
                        data: {
                            labels: facet.values.map(function (value) {
                                return value.label;
                            }),
                            datasets: [{
                                label: facet.field,
                                data: facet.values.map(function (value) {
                                    return value.count;
                                }),
                                backgroundColor: facet.values.map(function () {
                                    return rgbaRandomOpaqueColorAsString();
                                })
                            }]
                        },
                        options: {
                            cutoutPercentage: 90
                        }
                    };
                }
                return options;
            }
        </script>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="index"
        data-source-class="org.roda.core.data.v2.ip.IndexedFile"
        data-source-facets="formatPronom"
        data-view="chart"
        data-view-field="facetResults"
        data-view-type="function"
        data-view-type-function="facetCustomDataHandlerChartOptions">&lt;/canvas>
&lt;script type="text/javascript">
    function facetCustomDataHandlerChartOptions(data, element){
        var options = {};
        var facet = data.facetResults.length > 0 ? data.facetResults[0] : null;
        if (facet) {
            options = {
                type: "pie",
                data: {
                    labels: facet.values.map(function (value) {
                        return value.label;
                    }),
                    datasets: [{
                        label: facet.field,
                        data: facet.values.map(function (value) {
                            return value.count;
                        }),
                        backgroundColor: facet.values.map(function () {
                            return rgbaRandomOpaqueColorAsString();
                        })
                    }]
                },
                options: {
                    cutoutPercentage: 90
                }
            };
        }
        return options;
    }
&lt;/script>
            </code>
        </pre>
    </div>

    <h2>Função personalizada para criar gráfico</h2>
    <h3>Gráfico de bolhas</h3>
    <div class="half">
        <canvas class="statistic"
                data-source="function"
                data-function="customDataBubbleChart"></canvas>
        <script type="text/javascript">
            function customDataBubbleChart(element) {
                new Chart(element, {
                    type: 'bubble',
                    data: {
                        datasets: [{
                            label: "Test dataset",
                            data: [-3,-2,-1,0,1,2,3].map(function (value) {
                                return {
                                    x: value,
                                    y: value * value,
                                    r: Math.abs(value) * 10
                                };
                            }),
                            backgroundColor: rgbaRandomOpaqueColorAsString(),
                            hoverBackgroundColor: rgbaRandomOpaqueColorAsString()
                        }]
                    }
                });
            }
        </script>
    </div>
    <div class="half">
        <pre>
            <code class="html">
&lt;canvas class="statistic"
        data-source="function"
        data-function="customDataBubbleChart">&lt;/canvas>
&lt;script type="text/javascript">
    function customDataBubbleChart(element) {
        new Chart(element, {
            type: 'bubble',
            data: {
                datasets: [{
                    label: "Test dataset",
                    data: [-3,-2,-1,0,1,2,3].map(function (value) {
                        return {
                            x: value,
                            y: value * value,
                            r: Math.abs(value) * 10
                        };
                    }),
                    backgroundColor: rgbaRandomOpaqueColorAsString(),
                    hoverBackgroundColor: rgbaRandomOpaqueColorAsString()
                }]
            }
        });
    }
&lt;/script>
            </code>
        </pre>
    </div>

</div>
