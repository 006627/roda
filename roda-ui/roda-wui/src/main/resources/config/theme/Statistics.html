<div id="statistics" class="static-page max-width">
	<h1>Statistics</h1>

	<h2>AIP Index</h2>

	<div class="row full_width">
		<div class="col_4 col_card">
			<h4>Total No. of descriptive records</h4>
			<div class="textfill">
				<span class="statistic" data-source="index"
					data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
					data-view="text" data-view-field="totalCount"></span>
			</div>
		</div>
		<div class="col_4 col_card">
			<h4>Total No. of fonds</h4>
			<div class="textfill">
				<span class="statistic" data-source="index"
					data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
					data-source-filters="level=fonds" data-view="text"
					data-view-field="totalCount"></span>
			</div>
		</div>
		<div class="col_4 col_card">
			<h4>Distribution of description levels</h4>
			<canvas class="statistic" data-source="index"
				data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
				data-source-facets="level" data-view="chart"
				data-view-field="facetResults" data-view-type="pie"></canvas>
		</div>
	</div>


	<h2>Representations Index</h2>

	<div class="row full_width">
		<div class="col_6 col_card">
			<h4>Total No of Representations</h4>
			<div class="textfill">
				<span class="statistic" data-source="index"
					data-source-class="org.roda.core.data.v2.ip.IndexedRepresentation"
					data-view="text" data-view-field="totalCount"></span>
			</div>
		</div>
		<div class="col_6 col_card">
			<h4>Distribution of representation types</h4>
			<canvas class="statistic" data-source="index"
				data-source-class="org.roda.core.data.v2.ip.IndexedRepresentation"
				data-source-facets="type" data-view="chart"
				data-view-field="facetResults" data-view-type="bar"></canvas>
		</div>
	</div>

	<h2>Files index</h2>

	<div class="row full_width">
		<div class="col_4 col_card">
			<h4>Total No. of files</h4>
			<div class="textfill">
				<span class="statistic" data-source="index"
					data-source-class="org.roda.core.data.v2.ip.IndexedFile"
					data-view="text" data-view-field="totalCount"></span>
			</div>
		</div>
		<div class="col_4 col_card">
			<h4>Distribution of mimetypes</h4>
			<canvas class="statistic" data-source="index"
				data-source-class="org.roda.core.data.v2.ip.IndexedFile"
				data-source-facets="formatMimetype" data-view="chart"
				data-view-field="facetResults" data-view-type="pie"></canvas>
		</div>
		<div class="col_4 col_card">
			<h4>Distribution of PRONOM IDs</h4>
			<canvas class="statistic" data-source="index"
				data-source-class="org.roda.core.data.v2.ip.IndexedFile"
				data-source-facets="formatPronom" data-view="chart"
				data-view-field="facetResults" data-view-type="doughnut"></canvas>
		</div>
	</div>


	<h2>Job index</h2>

	<div class="row full_width">
		<div class="col_4 col_card">
			<h4>Total No of Ingest jobs</h4>
			<div class="textfill">
				<span class="statistic" data-source="index"
					data-source-class="org.roda.core.data.v2.jobs.Job"
					data-source-filters="pluginType=INGEST, state=COMPLETED"
					data-source-facets="pluginType" data-view="text"
					data-view-field="totalCount"></span>
			</div>
		</div>
	</div>

	<h2>Users and groups index</h2>

	<div class="row full_width">
		<div class="col_6 col_card">
			<h4>Total No. of users</h4>
			<div class="textfill">
				<p>
					In the index there's no User and Group, only RODAMember. Can't find
					a way to query the index about the number of users. It could be
					done like this: retrieving all members, go through all of them and
					count how many users are in the list, but that <strong>would
						not scale</strong> to a large number of members.
				</p>
			</div>
		</div>
		<div class="col_6 col_card">
			<h4>Distribution of representation types</h4>
			<div class="textfill">
				<p>
					In the index there's no User and Group, only RODAMember. RODAMember
					doesn't have information about the member users, only
					<code>Group</code>
					has attribute
					<code>memberUserNames</code>
					.
				</p>
			</div>
		</div>
	</div>

	<h2>Log index</h2>
	
	<div class="row full_width">
		<div class="col_4 col_card">
			<h4>Total No of logins</h4>
			<div class="textfill">
				<span class="statistic" data-source="index"
			data-source-class="org.roda.core.data.v2.log.LogEntry"
			data-source-filters="actionComponent=org.roda.wui.api.controllers.UserLogin, actionMethod=login, state=SUCCESS"
			data-view="text" data-view-field="totalCount"></span>
			</div>
		</div>
		<div class="col_4 col_card">
			<h4>Total No of failed logins</h4>
			<div class="textfill">
			<span class="statistic" data-source="index"
			data-source-class="org.roda.core.data.v2.log.LogEntry"
			data-source-filters="actionComponent=org.roda.wui.api.controllers.UserLogin, actionMethod=login, state=FAILURE"
			data-view="text" data-view-field="totalCount"></span>
			</div>
		</div>
		<div class="col_4 col_card">
			<h4>Successful vs failed logins</h4>
			<canvas class="statistic" data-source="index"
			data-source-class="org.roda.core.data.v2.log.LogEntry"
			data-source-filters="actionComponent=org.roda.wui.api.controllers.UserLogin, actionMethod=login"
			data-source-facets="state" data-view="chart"
			data-view-field="facetResults" data-view-type="pie"></canvas>
		</div>
	</div>

	<h1>Other charts</h1>

	<h2>Line charts</h2>
	<h3>Description level distribution</h3>
	<div>
		<canvas class="statistic" data-source="index"
			data-source-class="org.roda.core.data.v2.ip.IndexedAIP"
			data-source-facets="level" data-view="chart"
			data-view-field="facetResults" data-view-type="line"></canvas>
	</div>

	<h2>Radar charts</h2>
	<h3>Pronom format distribution</h3>
	<div>
		<canvas class="statistic" data-source="index"
			data-source-class="org.roda.core.data.v2.ip.IndexedFile"
			data-source-facets="formatPronom" data-view="chart"
			data-view-field="facetResults" data-view-type="radar"></canvas>
	</div>

	<h2>Polar area charts</h2>
	<h3>Pronom format distribution</h3>
	<div>
		<canvas class="statistic" data-source="index"
			data-source-class="org.roda.core.data.v2.ip.IndexedFile"
			data-source-facets="formatPronom" data-view="chart"
			data-view-field="facetResults" data-view-type="polarArea"></canvas>
	</div>

	<h2>Custom function to handle facet data</h2>
	<h3>Pronon format distribution</h3>
	<div>
		<canvas class="statistic" data-source="index"
			data-source-class="org.roda.core.data.v2.ip.IndexedFile"
			data-source-facets="formatPronom" data-view="chart"
			data-view-field="facetResults" data-view-type="function"
			data-view-type-function="facetCustomDataHandlerChartOptions"></canvas>
		<script type="text/javascript">
			function facetCustomDataHandlerChartOptions(data, element) {
				var options = {};
				var facet = data.facetResults.length > 0 ? data.facetResults[0]
						: null;
				if (facet) {
					options = {
						type : "pie",
						data : {
							labels : facet.values.map(function(value) {
								return value.label;
							}),
							datasets : [ {
								label : facet.field,
								data : facet.values.map(function(value) {
									return value.count;
								}),
								backgroundColor : facet.values.map(function() {
									return rgbaRandomOpaqueColorAsString();
								})
							} ]
						},
						options : {
							cutoutPercentage : 90
						}
					};
				}
				return options;
			}
		</script>
	</div>


	<h2>Custom function to create chart</h2>
	<h3>Bubble chart</h3>
	<div>
		<canvas class="statistic" data-source="function"
			data-function="customDataBubbleChart"></canvas>
		<script type="text/javascript">
			function customDataBubbleChart(element) {
				new Chart(
						element,
						{
							type : 'bubble',
							data : {
								datasets : [ {
									label : "Test dataset",
									data : [ -3, -2, -1, 0, 1, 2, 3 ]
											.map(function(value) {
												return {
													x : value,
													y : value * value,
													r : Math.abs(value) * 10
												};
											}),
									backgroundColor : rgbaRandomOpaqueColorAsString(),
									hoverBackgroundColor : rgbaRandomOpaqueColorAsString()
								} ]
							}
						});
			}
		</script>
	</div>

</div>